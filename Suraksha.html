<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sign In</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="page-wrapper">
    <div class="signin-card">
      <div class="left-pane">
        
        <div class="placeholder-logo"> <img src="Logo.png" alt="SURAKSHA Logo" class="landing-logo"></div>
        <h1 class="title">Enter anonymised credentials</h1>
        <p class="subtitle">to continue to <span class="app-name">particiapte in our data collection process</span></p>
        <p class="subtitle"></p>
      </div>

      <div class="right-pane">
        <form>
          <div class="input-group">
            <label for="email">Email or phone</label>
            <input type="email" id="email" name="email" required />
          </div>

          <div class="input-group">
            <label for="email">Password</label>
            <input type="password" id="email" name="email" required />
          </div>

          <div class="links">
            <a href="#">Forgot Email</a>
          </div>

          <p class="policy">
            Before using this app, you can review 
            <a href="#" class="privacy-link">Surakshaâ€™s privacy policy</a> 
            and <a href="#" class="terms-link">Terms of Service</a>.
          </p>

          <div class="actions">
            <a href="#" class="link">Create sample credentials</a>
            <button type="submit" class="btn primary">Next</button>
          </div>
        </form>
      </div>
    </div>

    <footer class="footer">
      <div class="lang-select">English (United Kingdom)</div>
      <div class="footer-links">
        <a href="#">Help</a>
        <a href="#">Privacy</a>
        <a href="#">Terms</a>
      </div>
    </footer>
  </div>
    <div id="privacyModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Suraksha Privacy Policy</h2>
      <p>
        This is where your privacy policy content goes.
        Youâ€™ll explain what user data (like keystroke timings, typing speed, etc.)
        you collect, why you collect it, and how usersâ€™ consent is handled.
      </p>
    </div>
  </div>

  <div id="termsModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Terms of Service</h2>
      <p>
        This section includes the app usage terms â€” what users agree to when they
        use Suraksha, disclaimers, and data handling responsibilities.
      </p>
    </div>
  </div>
  <script src="script.js"></script>
  <script type="module">
    import { initCollectors, gatherAndSend } from './index.js';

    // Simple helper to generate uuid v4
    function uuidv4() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
          const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
          return v.toString(16);
      });
    }

    const form = document.querySelector('form');
    const privacyLink = document.querySelector('.privacy-link');
    const termsLink = document.querySelector('.terms-link');
    const privacyModal = document.getElementById('privacyModal');
    const termsModal = document.getElementById('termsModal');

    // modal open/close handlers
    document.querySelectorAll('.privacy-link, .terms-link').forEach(el=>{
      el.addEventListener('click', (e)=>{
        e.preventDefault();
        if (el.classList.contains('privacy-link')) privacyModal.style.display = 'flex';
        else termsModal.style.display = 'flex';
      });
    });
    document.querySelectorAll('.close').forEach(btn=>{
      btn.addEventListener('click', ()=> {
        privacyModal.style.display = 'none';
        termsModal.style.display = 'none';
      });
    });

    let baseMeta = null;

    form.addEventListener('submit', async (ev) => {
  ev.preventDefault();
  
  const consent = true;
  const taskId = 'typing_task_1';
  const submitBtn = form.querySelector('button[type="submit"]');

  // Disable button and start collectors
  submitBtn.disabled = true;
  submitBtn.textContent = 'Collecting...';
  const baseMeta = await initCollectors(taskId, consent);

  // Wait for e.g., 10 seconds to gather typing/mouse data
  setTimeout(async () => {
    try {
      console.log("Gathering data...");
      const payload = await gatherAndSend(baseMeta, "human");

      console.log("Data successfully sent to backend:", payload);

      // ðŸ”¹ Add small delay to ensure network completes cleanly
      await new Promise(r => setTimeout(r, 1000)); // 1s

      // ðŸ”¹ Then redirect
      window.location.href = 'thankyou.html';
    } catch (err) {
      console.error("Error sending payload:", err);
      alert("Something went wrong while uploading your data. Please try again.");
      submitBtn.disabled = false;
      submitBtn.textContent = 'Next';
    }
  }, 5000); // 5s of data capture
});

  </script>
  <script type="module">
      (function () {
        const sampleLink = document.querySelector(".link"); // "Create sample credentials"
        const form = document.querySelector("form");

        // Ensure required elements exist
        if (!sampleLink || !form) {
          console.warn(
            "Sample credentials: required elements not found, skipping."
          );
          return;
        }

        // Create container for sample creds display
        const sampleContainer = document.createElement("div");
        sampleContainer.id = "sampleCreds";
        sampleContainer.setAttribute("aria-live", "polite");
        sampleContainer.style = `
    margin-bottom: 12px;
    padding: 12px;
    border-radius:8px;
    background:#f7fbff;
    border:1px solid #e0eefc;
    font-size:0.95rem;
    display:none;
  `;

        sampleContainer.innerHTML = `
    <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:12px; flex-wrap:wrap;">
      <div style="flex:1; min-width:220px;">
        <div style="font-weight:600; margin-bottom:8px;">Sample credentials (type these manually)</div>
        <div style="font-size:0.95rem; line-height:1.4;">
          <div><strong>Username:</strong> <span id="sampleUsername" style="font-family:monospace;"></span></div>
          <div style="margin-top:6px;"><strong>Password:</strong> <span id="samplePassword" style="font-family:monospace;"></span></div>
        </div>
        <div style="margin-top:8px; font-size:0.85rem; color:#555;">
          <em>Do NOT paste â€” please type these credentials into the fields to capture typing behaviour.</em>
        </div>
      </div>

      <div style="display:flex; gap:8px; align-items:center;">
        <button id="regenSampleBtn" type="button" style="padding:8px 10px; border-radius:6px; border:none; background:#0ea5e9; color:#fff; cursor:pointer;">Regenerate</button>
        <button id="dismissSampleBtn" type="button" aria-label="Dismiss sample credentials" style="padding:6px 10px; border-radius:6px; border:1px solid #cbd5e1; background:#ffffff; cursor:pointer;">Dismiss</button>
      </div>
    </div>
  `;

        const firstInputGroup = form.querySelector(".input-group");
        if (firstInputGroup) {
          firstInputGroup.parentNode.insertBefore(
            sampleContainer,
            firstInputGroup
          );
        } else {
          form.insertBefore(sampleContainer, form.firstChild);
        }

        function randomWord() {
          const words = [
            "alpha",
            "beta",
            "gamma",
            "delta",
            "nova",
            "echo",
            "zen",
            "lumen",
            "orbit",
            "pixel",
            "sigma",
            "kappa",
            "tau",
            "orbit",
          ];
          return (
            words[Math.floor(Math.random() * words.length)] +
            (Math.floor(Math.random() * 900) + 100)
          );
        }

        function randomEmail() {
          return `${randomWord()}@gmail.com`;
        }

        function randomPassword(length = 12) {
          const chars =
            "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+[]{};:,.<>?";
          let out = "";
          for (let i = 0; i < length; i++) {
            out += chars.charAt(Math.floor(Math.random() * chars.length));
          }
          return out;
        }

        function showSample(email, password) {
          document.getElementById("sampleUsername").textContent = email;
          document.getElementById("samplePassword").textContent = password;
          sampleContainer.style.display = "block";
        }
        function hideSample() {
          sampleContainer.style.display = "none";
        }

        sampleLink.addEventListener("click", (e) => {
          e.preventDefault();
          const email = randomEmail();
          const pass = randomPassword(12);
          showSample(email, pass);
          // do not set input.value, do not focus â€” let the user type manually
        });

        sampleContainer
          .querySelector("#regenSampleBtn")
          .addEventListener("click", () => {
            const email = randomEmail();
            const pass = randomPassword(12);
            showSample(email, pass);
          });

        sampleContainer
          .querySelector("#dismissSampleBtn")
          .addEventListener("click", () => {
            hideSample();
          });

        form.addEventListener("submit", () => {
          hideSample();
        });
      })();
    </script>
  <script type="module" src="env/fingerprint.js"></script>
  <script type="module" src="core/transport.js?v=2"></script>
</body>
</html>
